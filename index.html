<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Badminton Player Group Randomizer</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
.card { border-radius: 15px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.card-header { border-radius: 15px 15px 0 0; font-weight: bold; }
.btn-primary { border-radius: 25px; padding: 10px 30px; font-weight: bold; }
.form-check { margin-bottom: 6px; }
</style>
</head>

<body>
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white text-center">
            <h1>üèì Badminton Player Group Randomizer</h1>
        </div>
        <div class="card-body">

            <!-- Player Selection -->
            <h4 class="text-center mb-3">Select Present Players</h4>
            <div class="row">
                <div class="col-md-4" id="beginnersCheckboxes"></div>
                <div class="col-md-4" id="intermediatesCheckboxes"></div>
                <div class="col-md-4" id="advancedCheckboxes"></div>
            </div>

            <div class="text-center mt-3">
                <button onclick="selectAll()" class="btn btn-outline-secondary btn-sm me-2">Select All</button>
                <button onclick="selectNone()" class="btn btn-outline-secondary btn-sm">Select None</button>
            </div>

            <div class="text-center mt-4">
                <button onclick="randomizeGroups()" class="btn btn-primary btn-lg w-100">üé≤ Randomize Groups</button>
            </div>

            <!-- Groups -->
            <div id="groupsContainer" class="mt-5" style="display:none;">
                <h3 class="text-center mb-3">Generated Groups</h3>
                <div class="row"></div>
            </div>

            <!-- Attendance Table -->
            <div class="mt-5">
                <h4 class="text-center">Attendance</h4>
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="playersTable"></tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<script>
/* ---------------- PLAYER DATA ---------------- */
const allPlayers = [
    { name: "Balaji", skill: "BEGINNER" },
    { name: "Prakash", skill: "BEGINNER" },
    { name: "Sree", skill: "BEGINNER" },
    { name: "Arun", skill: "INTERMEDIATE" },
    { name: "Dileep", skill: "INTERMEDIATE" },
    { name: "Bheesh", skill: "INTERMEDIATE" },
    { name: "Krishnamurthy", skill: "INTERMEDIATE" },
    { name: "Joseph", skill: "INTERMEDIATE" },
    { name: "Hashim", skill: "INTERMEDIATE" },
    { name: "Sudha", skill: "INTERMEDIATE" },
    { name: "Suren", skill: "INTERMEDIATE" },
    { name: "Kripa", skill: "INTERMEDIATE" },
    { name: "Santhosh", skill: "ADVANCED" },
    { name: "Charles", skill: "ADVANCED" },
    { name: "Faizee", skill: "ADVANCED" },
    { name: "Raaju", skill: "ADVANCED" },
    { name: "Arvind", skill: "ADVANCED" },
    { name: "Raja", skill: "ADVANCED" }
];

/* ---------------- INIT ---------------- */
document.addEventListener("DOMContentLoaded", () => {
    displayPlayerCheckboxes();
    updateAttendanceTable();
});

/* ---------------- UI ---------------- */
function displayPlayerCheckboxes() {
    const b = document.getElementById("beginnersCheckboxes");
    const i = document.getElementById("intermediatesCheckboxes");
    const a = document.getElementById("advancedCheckboxes");
    b.innerHTML = i.innerHTML = a.innerHTML = "";

    allPlayers.forEach(player => {
        const id = player.name.replace(/\s+/g, "-");
        const div = document.createElement("div");
        div.className = "form-check";
        div.innerHTML = `
            <input class="form-check-input" type="checkbox" id="check-${id}" onchange="updateAttendanceTable()">
            <label class="form-check-label" for="check-${id}">${player.name}</label>
        `;
        if(player.skill === "BEGINNER") b.appendChild(div);
        else if(player.skill === "INTERMEDIATE") i.appendChild(div);
        else a.appendChild(div);
    });
}

function selectAll() {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = true);
    updateAttendanceTable();
}

function selectNone() {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
    updateAttendanceTable();
}

/* ---------------- ATTENDANCE ---------------- */
function updateAttendanceTable() {
    const table = document.getElementById("playersTable");
    table.innerHTML = "";
    allPlayers.forEach(player => {
        const id = player.name.replace(/\s+/g, "-");
        const present = document.getElementById(`check-${id}`)?.checked;
        table.innerHTML += `
            <tr class="${present ? "" : "table-secondary"}">
                <td>${player.name}</td>
                <td><span class="badge ${present ? 'bg-success' : 'bg-secondary'}">
                    ${present ? "Present" : "Absent"}</span>
                </td>
            </tr>
        `;
    });
}

/* ---------------- RANDOMIZATION ---------------- */
function shuffle(arr) {
    for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}

function randomizeGroups() {
    const presentPlayers = allPlayers.filter(p => {
        const id = p.name.replace(/\s+/g,"-");
        return document.getElementById(`check-${id}`)?.checked;
    });

    const groups = generateGroups(presentPlayers);

    const row = document.querySelector("#groupsContainer .row");
    row.innerHTML = "";

    groups.forEach((group, idx) => {
        let teamsHTML = "";
        if(group.players.length === 4) {
            teamsHTML = `
                <div class="row mt-3">
                    <div class="col-6 text-center">
                        <strong>Team 1</strong><br>${group.team1.players.map(p=>p.name).join("<br>")}
                    </div>
                    <div class="col-6 text-center">
                        <strong>Team 2</strong><br>${group.team2.players.map(p=>p.name).join("<br>")}
                    </div>
                </div>`;
        }

        row.innerHTML += `
            <div class="col-md-6">
                <div class="card mb-3 ${group.forced?"border-warning":"border-primary"}">
                    <div class="card-header ${group.forced?"bg-warning":"bg-primary text-white"} text-center">
                        ${group.forced?"Forced Group ":"Group "} ${idx+1}
                    </div>
                    <div class="card-body text-center">
                        ${group.players.map(p=>`<span class="badge bg-secondary m-1">${p.name}</span>`).join("")}
                        ${teamsHTML}
                    </div>
                </div>
            </div>`;
    });

    document.getElementById("groupsContainer").style.display = "block";
}

/* ---------------- GROUP LOGIC ---------------- */
function generateGroups(players) {
    const shuffled = shuffle([...players]);

    const beginners = shuffled.filter(p=>p.skill==="BEGINNER");
    const intermediates = shuffled.filter(p=>p.skill==="INTERMEDIATE");
    const advanced = shuffled.filter(p=>p.skill==="ADVANCED");

    const groups = [];
    let remaining = [...shuffled];

    while(remaining.length>=4){
        const groupPlayers = remaining.splice(0,4);
        const group = {players: groupPlayers, forced:false};
        splitTeams(group);
        groups.push(group);
    }

    // Any leftover players (less than 4) form a forced group
    while(remaining.length>0){
        const toTake = remaining.splice(0,4);
        const group = {players:toTake, forced:true};
        splitTeams(group);
        groups.push(group);
    }

    return groups;
}

function splitTeams(group){
    const shuffled = shuffle([...group.players]);
    group.team1 = {players: shuffled.slice(0,2)};
    group.team2 = {players: shuffled.slice(2,4)};
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
