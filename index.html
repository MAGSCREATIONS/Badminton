<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Player Group Randomizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            border-radius: 15px 15px 0 0;
            font-weight: bold;
        }
        .btn-primary {
            border-radius: 25px;
            padding: 10px 30px;
            font-weight: bold;
        }
    </style>
</head>

<body>
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white text-center">
            <h1>üèì Badminton Player Group Randomizer</h1>
        </div>

        <div class="card-body">
            <p class="text-center">
                Groups are created using internal skill logic.<br>
                Skill levels are <strong>not displayed</strong>.
            </p>

            <!-- Player Selection -->
            <div class="row">
                <div class="col-md-4">
                    <h5 class="text-center">Beginners</h5>
                    <div id="beginnersCheckboxes"></div>
                </div>
                <div class="col-md-4">
                    <h5 class="text-center">Intermediates</h5>
                    <div id="intermediatesCheckboxes"></div>
                </div>
                <div class="col-md-4">
                    <h5 class="text-center">Advanced</h5>
                    <div id="advancedCheckboxes"></div>
                </div>
            </div>

            <div class="text-center mt-3">
                <button onclick="selectAll()" class="btn btn-outline-secondary btn-sm">Select All</button>
                <button onclick="selectNone()" class="btn btn-outline-secondary btn-sm">Select None</button>
            </div>

            <div class="text-center mt-4">
                <button onclick="randomizeGroups()" class="btn btn-primary btn-lg w-100">
                    üé≤ Randomize Groups
                </button>
            </div>

            <!-- Groups -->
            <div id="groupsContainer" class="mt-5" style="display:none;">
                <h3 class="text-center mb-3">Generated Groups</h3>
                <div class="row"></div>
            </div>

            <!-- All Players -->
            <div class="mt-5">
                <h4 class="text-center">All Players</h4>
                <table class="table table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="playersTable"></tbody>
                </table>
            </div>

            <p class="text-center text-muted mt-4">
                üïäÔ∏è In memory of Anand
            </p>
        </div>
    </div>
</div>

<script>
/* ---------------- PLAYER DATA ---------------- */

const allPlayers = [
    { name: "Balaji", skill: "BEGINNER" },
    { name: "Anand (Forever in our memories)", skill: "BEGINNER", memorial: true },
    { name: "Prakash", skill: "BEGINNER" },
    { name: "Sree", skill: "BEGINNER" },

    { name: "Arun", skill: "INTERMEDIATE" },
    { name: "Dileep", skill: "INTERMEDIATE" },
    { name: "Bheesh", skill: "INTERMEDIATE" },
    { name: "Kirshnamurthy", skill: "INTERMEDIATE" },
    { name: "Joseph", skill: "INTERMEDIATE" },
    { name: "Hashim", skill: "INTERMEDIATE" },
    { name: "Santhosh", skill: "INTERMEDIATE" },
    { name: "Sudha", skill: "INTERMEDIATE" },
    { name: "Suren", skill: "INTERMEDIATE" },
    { name: "Kripa", skill: "INTERMEDIATE" },

    { name: "Charles", skill: "ADVANCED" },
    { name: "Faizee", skill: "ADVANCED" },
    { name: "Raaju", skill: "ADVANCED" },
    { name: "Arvind", skill: "ADVANCED" },
    { name: "Raja", skill: "ADVANCED" }
];

/* ---------------- INIT ---------------- */

document.addEventListener("DOMContentLoaded", () => {
    displayPlayerCheckboxes();
    displayAllPlayers();
});

/* ---------------- UI FUNCTIONS ---------------- */

function displayPlayerCheckboxes() {
    const beginnersCheckboxes = document.getElementById("beginnersCheckboxes");
    const intermediatesCheckboxes = document.getElementById("intermediatesCheckboxes");
    const advancedCheckboxes = document.getElementById("advancedCheckboxes");

    beginnersCheckboxes.innerHTML = "";
    intermediatesCheckboxes.innerHTML = "";
    advancedCheckboxes.innerHTML = "";

    allPlayers.forEach(player => {
        if (player.memorial) return;

        const safeId = player.name.replace(/\s+/g, "-");

        const div = document.createElement("div");
        div.className = "form-check";
        div.innerHTML = `
            <input class="form-check-input" type="checkbox" id="check-${safeId}">
            <label class="form-check-label" for="check-${safeId}">
                ${player.name}
            </label>
        `;

        if (player.skill === "BEGINNER") {
            beginnersCheckboxes.appendChild(div);
        } else if (player.skill === "INTERMEDIATE") {
            intermediatesCheckboxes.appendChild(div);
        } else {
            advancedCheckboxes.appendChild(div);
        }
    });
}

function selectAll() {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = true);
    displayAllPlayers();
}

function selectNone() {
    document.querySelectorAll("input[type=checkbox]").forEach(cb => cb.checked = false);
    displayAllPlayers();
}

function displayAllPlayers() {
    const table = document.getElementById("playersTable");
    table.innerHTML = "";

    allPlayers.forEach(player => {
        if (player.memorial) {
            table.innerHTML += `
                <tr class="table-secondary">
                    <td>${player.name}</td>
                    <td>In Memory</td>
                </tr>`;
            return;
        }

        const safeId = player.name.replace(/\s+/g, "-");
        const checked = document.getElementById(`check-${safeId}`)?.checked;

        table.innerHTML += `
            <tr class="${checked ? "" : "table-secondary"}">
                <td>${player.name}</td>
                <td>${checked ? "Present" : "Absent"}</td>
            </tr>`;
    });
}

/* ---------------- CORE LOGIC (UNCHANGED) ---------------- */

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function randomizeGroups() {
    const presentPlayers = allPlayers.filter(p => {
        if (p.memorial) return false;
        const safeId = p.name.replace(/\s+/g, "-");
        return document.getElementById(`check-${safeId}`)?.checked;
    });

    const groups = randomizePlayers(presentPlayers);

    const container = document.querySelector("#groupsContainer .row");
    container.innerHTML = "";

    groups.forEach((group, i) => {
        let teamsHTML = "";

        if (group.players.length === 4 && group.team1 && group.team2) {
            teamsHTML = `
                <div class="row mt-3">
                    <div class="col-6 text-center">
                        <strong>Team 1</strong><br>
                        ${group.team1.players.map(p => p.name).join("<br>")}
                    </div>
                    <div class="col-6 text-center">
                        <strong>Team 2</strong><br>
                        ${group.team2.players.map(p => p.name).join("<br>")}
                    </div>
                </div>`;
        }

        container.innerHTML += `
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white text-center">
                        Group ${i + 1}
                    </div>
                    <div class="card-body text-center">
                        ${group.players.map(p => `<span class="badge bg-secondary m-1">${p.name}</span>`).join("")}
                        ${teamsHTML}
                    </div>
                </div>
            </div>`;
    });

    document.getElementById("groupsContainer").style.display = "block";
}

/* ---------- ORIGINAL GROUP + TEAM LOGIC ---------- */

function randomizePlayers(players) {
    const shuffled = shuffle([...players]);

    const beginners = shuffled.filter(p => p.skill === 'BEGINNER');
    const intermediates = shuffled.filter(p => p.skill === 'INTERMEDIATE');
    const advanced = shuffled.filter(p => p.skill === 'ADVANCED');

    const groups = [];
    let groupNumber = 1;

    while (true) {
        const group = tryFormGroup(beginners, intermediates, advanced, groupNumber++);
        if (group && group.players.length === 4) {
            groups.push(group);
        } else {
            break;
        }
    }

    const remaining = [...beginners, ...intermediates, ...advanced];
    if (remaining.length) {
        groups.push({ groupNumber, players: remaining, isForced: true });
    }

    groups.forEach(group => {
        if (group.players.length === 4) {
            splitIntoTeams(group);
        }
    });

    return groups;
}

function tryFormGroup(b, i, a, num) {
    if (b.length + i.length + a.length < 4) return null;

    const group = { groupNumber: num, players: [] };

    if (i.length >= 2) group.players.push(i.pop(), i.pop());
    if (b.length) group.players.push(b.pop());
    if (a.length && group.players.length < 4) group.players.push(a.pop());
    if (group.players.length < 4 && i.length) group.players.push(i.pop());

    return group;
}

function splitIntoTeams(group) {
    const shuffled = shuffle([...group.players]);
    group.team1 = { players: [shuffled[0], shuffled[1]] };
    group.team2 = { players: [shuffled[2], shuffled[3]] };
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
